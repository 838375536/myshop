<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="js/html5.js"></script>
    <script type="text/javascript" src="js/respond.min.js"></script>
    <script type="text/javascript" src="js/PIE_IE678.js"></script>
    <![endif]-->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link href="assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="Widget/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css"/>
    <![endif]-->
    <link href="Widget/icheck/icheck.css" rel="stylesheet" type="text/css"/>
    <link href="Widget/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css"/>
    <title>新增商品</title>
</head>
<body>
<div class="clearfix" id="add_picture">
    <div id="scroll">
    </div>
    <div class="page_right_style" style="left: 0px;width: 100%;" ng-app="myApp"
         ng-controller="goodEditCtrl">
        <div class="type_title">编辑商品</div>
        <form action="#" class="form form-horizontal" style="border:solid 1px lightgrey;min-width:500px;max-width:600px;margin:0 auto;" id="form-article-add" >
            <div class="clearfix cl">
                <div class="formControls col-10">
                    <label style="display:block;float:left;" class="form-label col-2"><span class="c-red"
                                                                                            style="color: red;">*</span>商品名称：</label>
                    <input ng-model="good.name" id="goodName" style="display:block;float:left;width:60%;" type="text" class="input-text">
                </div>
            </div>
            <!--<div class=" clearfix cl">-->
                <!--<div class="formControls col-10">-->
                    <!--<label class="form-label col-2" style="display:block;float:left;">&nbsp;商品编号：</label>-->
                    <!--<input ng-model="good.introduce" id="introduce" style="display:block;float:left;width:60%;" type="text"-->
                           <!--class="input-text">-->
                <!--</div>-->
            <!--</div>-->
            <div class=" clearfix cl">
                <div class="formControls col-10">
                    <label class="form-label col-2" style="display:block;float:left;">&nbsp;商品简介：</label>
                    <input ng-model="good.introduce" id="introduce" style="display:block;float:left;width:60%;" type="text"
                           class="input-text">
                </div>
            </div>
            <div class=" clearfix cl">
                <div style="display: inline-block;width: 100%;">
                    <div class="Add_p_s" style="margin-left:20px;">
                        <label class="form-label col-2"><span class="c-red" style="color: red;">*</span>价&nbsp;&nbsp;格(元)：</label>
                        <div class="formControls col-2">
                            <input type="text" id="price" ng-model="good.price" class="input-text" value="" placeholder="">
                        </div>
                    </div>
                    <div class="Add_p_s">
                        <label class="form-label col-2">库&nbsp;&nbsp;&nbsp;&nbsp;存：</label>
                        <div class="formControls col-2"><input type="text" class="input-text" ng-model="good.count"
                                                               value="999" placeholder="" id="count" name="">
                        </div>
                    </div>
                </div>

                <div class="Add_p_s" style="margin-left: 10px;">
                    <label class="form-label col-2">商品分类：</label>
                    <div class="formControls col-2"><span class="select-box">
				<select id="categorys" class="select" ng-model="selectedCategory" >
                        <option ng-repeat="cat in category"  value="{{cat.id}}">{{cat.name}}</option>
                    <!--<option value="1" selected>饮料</option>-->
                    <!--<option value="2">零食</option>-->
                    <!--<option value="3">家电</option>-->
                    <!--<option value="4">日常用品</option>-->
                    <!--<option value="5">家居</option>-->
				</select>
				</span></div>
                </div>

                <div class="Add_p_s" style="min-height:170px;min-width:580px;max-width:980px;margin-left: 10px;padding-top:10px;border-top:1px solid gray;border-bottom:1px solid gray;width：520px;padding-right:100px;height:130px;">
                    <div style="width:550px;">
                        <span style="display: inline-block;font-size: 15px;margin-left:30px;">商品款式：</span>
                        <div class="form-inline" style="float: right;">
                            <input  id="content_value" class="form-group text-info" style="width:110px;margin-right: 0px;font-size: 16px;line-height: 23px;" type="text" value="" /><input  type="button" onclick="addContent()" style="margin-left: 0px;margin-right: 0px;" class="form-group btn btn-success" value="添加款式" />
                        </div>
                        <div style="margin-top: 25px;margin-left:20px;padding-left:20px;font-size:14px;" class="form-inline">
                            <label id="content_1" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_2" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_3" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_4" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_5" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_6" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_7" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_8" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_9" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_10" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_11" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_12" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_13" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_14" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_15" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_16" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_17" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_18" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_19" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                            <label id="content_20" class="label label-xlg form-group" style="margin-right:20px;margin-bottom:5px;display: none;padding:5px 0px;padding-left:7px;font-size: 15px;"></label>
                        </div>
                    </div>
                </div>

                <!--<div class="Add_p_s" style="margin-left: 25px;">-->
                    <!--<label class="form-label col-2">是否上架？:&nbsp;&nbsp;</label><input id="onSales" ng-model="good.onSale" type="checkbox"-->
                                                                                     <!--checked style="height: 30px;">-->
                    <!--<div class="formControls col-2">-->

                    <!--</div>-->
                <!--</div>-->
            </div>
            <div class="clearfix cl">
                <label class="form-label col-2" style="margin-left: 35px; display:inline;">商品图片上传：</label>
                <div style="float:left;border:dotted 1px gray;border-radius:3px; ">
                    <img id="image" src='images/uploadGoodImg.png' alt=" "
                         style="margin:5px;width: 135px; height: 90px;"/>
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4">
                    <div class="file-container"
                         style="display:inline-block;position:relative;overflow: hidden;vertical-align:middle">
                        <button class="btn btn-success fileinput-button" type="button">修改</button>
                        <input type="file" id="imgFile" ng-model="good.file" onchange="selectImage(this);"
                               style="position:absolute;top:0;left:0;font-size:34px; opacity:0">
                    </div>
                </div>
            </div>
            <div class="clearfix cl" style="text-align:center;margin-top: 30px;margin-bottom: 5px;">
                <div class="Button_operation">
                    <button  ng-click="updateGood()" class="btn btn-primary radius" type="submit"><i class="icon-save "></i>修改商品
                    </button>
                    <button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                </div>
            </div>
        </form>
    </div>
</div>
</div>
<script src="js/jquery-1.9.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/typeahead-bs2.min.js"></script>
<script src="assets/layer/layer.js" type="text/javascript"></script>
<script src="assets/laydate/laydate.js" type="text/javascript"></script>
<script type="text/javascript" src="Widget/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="Widget/icheck/jquery.icheck.min.js"></script>
<script type="text/javascript" src="Widget/zTree/js/jquery.ztree.all-3.5.min.js"></script>
<script type="text/javascript" src="Widget/Validform/5.3.2/Validform.min.js"></script>
<script type="text/javascript" src="Widget/webuploader/0.1.5/webuploader.min.js"></script>
<script src="js/lrtk.js" type="text/javascript"></script>
<script type="text/javascript" src="js/H-ui.js"></script>
<script type="text/javascript" src="js/H-ui.admin.js"></script>
<script>
    $(function () {
        $("#add_picture").fix({
            float: 'left',
            skin: 'green',
            durationTime: false,
            stylewidth: '220',
            spacingw: 0,
            spacingh: 260,
        });
    });
    $(document).ready(function () {
        //初始化宽度、高度
        $(".widget-box").height($(window).height());
        $(".page_right_style").height($(window).height());
        $(".page_right_style").width($(window).width());
        //当文档窗口发生改变时 触发
        $(window).resize(function () {

            $(".widget-box").height($(window).height());
            $(".page_right_style").height($(window).height());
            $(".page_right_style").width($(window).width());
        });
    });
    // $(function () {
    //     var ue = UE.getEditor('editor');
    // });

</script>
</body>
<script src="js/angular.min.js"></script>
<script>
    var good_id = getCookie("good_id");
    var app = angular.module('myApp', []);
    var this_category = 0;
    var good_style = "";
    app.controller('goodEditCtrl', function ($scope, $http) {
        $scope.category = ["饮料", "零食", "日常用品", "家居", "电器", "粮油", "烟酒"];
        $scope.good={name:"",introduce:"",price:0,count:99,status:1,content:""};
        var formData = new FormData();

        $scope.getrecommend = function () {
            $http({
                method: 'POST',
                url: '/category/findMore',
                params: {}
            }).then(function successCallback(response) {
                // data = response.data;
                $scope.category = response.data;
            }, function errorCallback(response) {
                // 请求失败执行代码
                console.log("网络异常！请联系管理员！");
            });
        }
        $scope.getrecommend();

        $scope.updateGood = function () {
            formData = new FormData();
            var img = $('#imgFile')[0].files[0];
            formData.append('image', img);
            formData.append('id', good_id);
            formData.append('name',$("#goodName").val());
            formData.append('introduce',$("#introduce").val());
            formData.append('price',$("#price").val());
            var check = checkPrice($scope.good.price);
            if(!check){
                $scope.good.price = 0;
                return false;
            }
            formData.append('count',$("#count").val());
            check = checkPrice($scope.good.count);
            if(!check){
                $scope.good.count = 999;
                return false;
            }
            var status = 2;
            if($("#onSales").is(':checked'))
                status = 1;
            formData.append('status',status);
            getGoodStyle();
            formData.append('content',good_style);
            var c = $scope.selectedCategory;
            if(c==null){
                c = this_category;
            }
            formData.append('category',c);
            $http({
                method: 'POST',
                url: '/good/update',
                data:formData,
                headers:{'Content-Type':undefined},
                transformRequest: angular.identity
            }).then(function successCallback(response) {
                alert("修改商品信息成功！");
                parent.location.href="Products_List2.html";
                layer_close();
            }, function errorCallback(response) {
                // 请求失败执行代码
                console.log("网络异常！请联系管理员");
            });
        }
    });

    var content_id = "#content_";
    var arrs = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var arrs_content = ["","","","","","","","","","","","","","","","","","","",""];
    var no = 0;

    function initGoodStyle() {
        var styles = good_style.split("@");
        if(!$.trim(styles)){
            return false;
        }
        for(var i=0;i<styles.length;i++){
            $(content_id+(i+1)).css('display','inline-block');
            arrs[i] = 1;
            arrs_content[i] = styles[i];
            no++;
            document.getElementById("content_"+(i+1)).innerHTML=styles[i]+" &nbsp&nbsp<a href='javascript:;' style='float:right;margin-top: -2px;' class='btn btn-minier btn-danger' onclick='removeContent("+(i+1)+")'><i class='icon-remove smaller-20'></i></a>";
        }
        good_style = "";
    }

    function addContent(){
        var content_val = $("#content_value").val();
        arrs[no] = 1;
        arrs_content[no] = content_val;
        no = no + 1;
        var id = content_id + no;
        $(content_id+no).css('display','inline-block');
        document.getElementById("content_"+no).innerHTML=content_val+" &nbsp&nbsp<a href='javascript:;' style='float:right;margin-top: -2px;' class='btn btn-minier btn-danger' onclick='removeContent("+no+")'><i class='icon-remove smaller-20'></i></a>";
        $("#content_value").val("");
    }

    function removeContent(index){
        arrs[index-1] = 0;
        $(content_id+index).css('display','none');
    }

    function getGoodStyle() {
        for(i=0;i<20;i++){
            if(arrs[i]==1){
                good_style+=arrs_content[i]+"@";
            }
        }
        good_style = good_style.substr(0,good_style.length-1);
    }

    function checkPrice() {
        var number = $("#price").val();
        var strP = /^\d+(.\d+)?$/; //正则
        if (!strP.test(number)) {
            alert("输入价格格式有误");
            return false;
        }
        return true;
    }
</script>
<script>
    var image = '';

    function selectImage(file) {
        if (!file.files || !file.files[0]) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function (evt) {
            document.getElementById('image').src = evt.target.result;
            image = evt.target.result;
        }
        reader.readAsDataURL(file.files[0]);
    }
    // var cc = ["饮料", "零食", "日常用品", "家居", "电器", "粮油", "烟酒"];
    window.onload = function (ev) {
        initData();
    }

    function initData() {
        $("#goodName").val(getCookie("good_name"));
        $("#introduce").val(getCookie("good_introduce"));
        $("#price").val(getCookie("good_price"));
        $("#count").val(getCookie("good_count"));
        good_style = getCookie("good_content");
        initGoodStyle();
        var no = getCookie("good_category");
        $("#categorys").val(no);
        this_category = no;
        $("#image").attr('src',getCookie("good_image")) ;
    }



</script>
</html>